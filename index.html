<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tajinier M√©rignac - Avis & Roulette</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Inter',sans-serif;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px;color:#111827;transition:background .5s}
    body.step1{background:radial-gradient(circle at top,#fee2e2,#f8fafc)}
    body.step2{background:radial-gradient(circle at top,#111827,#020617);color:white}
    .container{max-width:900px;width:100%;text-align:center}
    
    #avisPage{display:block}
    .card{max-width:520px;margin:0 auto;background:white;border-radius:28px;box-shadow:0 25px 60px -20px rgba(0,0,0,.45);padding:28px 22px 26px;text-align:center}
    .badge{display:inline-flex;align-items:center;gap:6px;background:rgba(239,68,68,.1);color:#b91c1c;border-radius:999px;padding:4px 10px;font-size:.8rem;font-weight:500;margin-bottom:10px}
    .logo{font-size:2.4rem;font-weight:700;background:linear-gradient(135deg,#ef4444,#dc2626);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:4px}
    .subtitle{color:#6b7280;margin-bottom:16px}
    .adresse{font-size:.9rem;color:#9ca3af;margin-bottom:24px}
    input[type="email"]{width:100%;padding:14px 16px;border-radius:999px;border:1px solid #e5e7eb;font-family:inherit;font-size:.95rem;margin-bottom:16px;box-shadow:0 4px 10px rgba(0,0,0,.05);transition:.2s}
    input[type="email"]:focus{outline:none;border-color:#ef4444;box-shadow:0 10px 25px rgba(239,68,68,.25);transform:translateY(-1px)}
    label{font-size:.9rem;font-weight:500;color:#4b5563;display:block;text-align:left;margin-bottom:6px}
    .btn-primary{width:100%;padding:16px 20px;border-radius:999px;border:none;background:linear-gradient(135deg,#ef4444,#dc2626);color:white;font-size:1.05rem;font-weight:600;cursor:pointer;box-shadow:0 20px 35px -18px rgba(239,68,68,.8);transition:.18s;margin-top:4px}
    .btn-primary:hover{transform:translateY(-2px);box-shadow:0 24px 60px -20px rgba(239,68,68,.9)}
    .info{margin-top:16px;font-size:.85rem;color:#6b7280;text-align:left;background:#f9fafb;padding:12px 14px;border-radius:12px}
    .sep{margin:18px 0 10px;border-top:1px dashed #e5e7eb}
    .btn-secondary{margin-top:6px;width:100%;padding:12px 16px;border-radius:999px;border:1px solid #10b981;background:rgba(16,185,129,.08);color:#047857;font-size:.95rem;font-weight:500;cursor:pointer;transition:.2s}
    .btn-secondary:hover{background:rgba(16,185,129,.15);transform:translateY(-1px)}
    .small{font-size:.78rem;color:#9ca3af;margin-top:8px;text-align:left}

    #roulettePage{display:none}
    .wrapper{display:flex;flex-wrap:wrap;align-items:center;justify-content:center;gap:32px}
    .wheel-container{position:relative;width:360px;height:360px;border-radius:50%;background:radial-gradient(circle at 30% 30%,#facc15,#b45309);display:flex;align-items:center;justify-content:center;box-shadow:0 40px 80px rgba(0,0,0,.8)}
    #wheel{width:320px;height:320px;border-radius:50%;background:#020617;box-shadow:0 0 0 6px #facc15,0 0 30px rgba(250,204,21,.7)}
    .pointer{position:absolute;top:-18px;left:50%;transform:translateX(-50%);width:0;height:0;border-left:18px solid transparent;border-right:18px solid transparent;border-bottom:30px solid #facc15;filter:drop-shadow(0 4px 6px rgba(0,0,0,.8))}
    .side{max-width:380px;color:white}
    .title{font-size:2rem;font-weight:700;margin-bottom:6px}
    .chip{display:inline-block;background:linear-gradient(135deg,#f97316,#ea580c);padding:6px 12px;border-radius:999px;font-size:.8rem;margin-bottom:18px;color:white}
    .btn-spin{margin-top:12px;width:100%;padding:14px;border-radius:999px;border:none;background:linear-gradient(135deg,#22c55e,#16a34a);color:white;font-size:1rem;font-weight:600;cursor:pointer;box-shadow:0 25px 40px -18px rgba(34,197,94,.9);transition:.2s}
    .btn-spin:hover{transform:translateY(-2px);box-shadow:0 30px 60px -20px rgba(34,197,94,1)}
    .result{margin-top:18px;font-size:1.2rem;font-weight:600;min-height:28px;color:white}
    .small-wheel{margin-top:10px;font-size:.85rem;color:#9ca3af}
    @media(max-width:768px){.wrapper{flex-direction:column}}
  </style>
</head>
<body class="step1">
  <div class="container">
    
    <div id="avisPage">
      <div class="card">
        <div class="badge">‚≠ê Avis client ‚Ä¢ Tajinier M√©rignac</div>
        <div class="logo">Tajinier</div>
        <p class="subtitle">Merci d'avoir mang√© chez nous ! Laissez-nous un avis Google et tentez de gagner üéÅ</p>
        <p class="adresse">49 Bis Av. Henri Vigneau, 33700 M√©rignac</p>

        <form id="avisForm">
          <label for="email">Votre email (pour le tirage √† la roulette)</label>
          <input type="email" id="email" placeholder="vous@example.com" required>

          <button type="submit" class="btn-primary">‚≠ê Laisser un avis Google</button>
        </form>

        <div class="info">
          ‚úÖ Vous serez redirig√© vers Google pour laisser votre avis.<br>
          ‚úÖ Une fois publi√©, revenez ici avec le bouton retour.<br>
          ‚úÖ Tentez de gagner un tajine, une boisson ou un dessert !
        </div>

        <div class="sep"></div>

        <button class="btn-secondary" id="goToRoulette">
          üé∞ J'ai publi√© mon avis ‚Üí acc√©der √† la roulette
        </button>
        <div class="small">
          Cliquez apr√®s avoir r√©ellement publi√© votre avis sur Google.
        </div>
      </div>
    </div>

    <div id="roulettePage">
      <div class="wrapper">
        <div class="wheel-container">
          <canvas id="wheel" width="320" height="320"></canvas>
          <div class="pointer"></div>
        </div>
        <div class="side">
          <div class="title">Roulette gourmande</div>
          <p class="subtitle">Merci pour votre avis Google ! Tournez la roue et d√©couvrez ce que vous avez gagn√© üéâ</p>
          <div class="chip">Tajinier ‚Ä¢ Jeu instantan√©</div>
          <button id="spinBtn" class="btn-spin">üé∞ Lancer la roulette</button>
          <div id="result" class="result"></div>
          <div class="small-wheel">Email : <span id="emailDisplay">inconnu</span><br>Pr√©sentez ce r√©sultat √† l'√©quipe en salle pour recevoir votre gain.</div>
        </div>
      </div>
    </div>

  </div>

  <script>
    // LIEN DIRECT VERS AVIS GOOGLE - BON PLACE ID
    const reviewUrl = 'https://search.google.com/local/writereview?placeid=ChIJ5yphIvDZVA0Rykpm0HohmHA';
    
    document.getElementById('avisForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const email = document.getElementById('email').value.trim();

      if(!/\S+@\S+\.\S+/.test(email)){ 
        alert("‚ö†Ô∏è Email invalide."); 
        return; 
      }

      localStorage.setItem('lastEmail', email);
      window.location.href = reviewUrl;
    });

    document.getElementById('goToRoulette').addEventListener('click', ()=>{
      document.getElementById('avisPage').style.display = 'none';
      document.getElementById('roulettePage').style.display = 'block';
      document.body.classList.remove('step1');
      document.body.classList.add('step2');
      initRoulette();
    });

    const prizes = [
      { label:'Canette gratuite', color:'#22c55e', prob:0.2 },
      { label:'Bi√®re pression', color:'#f97316', prob:0.15 },
      { label:'Tajine offert', color:'#ef4444', prob:0.15 },
      { label:'Desserts maison', color:'#ec4899', prob:0.15 },
      { label:'Th√© √† la menthe', color:'#22c55e', prob:0.1 },
      { label:'10% reduc prochain', color:'#3b82f6', prob:0.1 },
      { label:'Rien aujourd'hui', color:'#6b7280', prob:0.15 }
    ];

    let canvas, ctx, center, radius, segments, currentAngle = 0, spinning = false;

    function initRoulette(){
      const lastEmail = localStorage.getItem('lastEmail');
      if(lastEmail) document.getElementById('emailDisplay').textContent = lastEmail;

      canvas = document.getElementById('wheel');
      ctx = canvas.getContext('2d');
      center = canvas.width / 2;
      radius = center - 8;

      const totalProb = prizes.reduce((s,p)=>s+p.prob,0);
      segments = prizes.map(p=>({...p,angle:(p.prob/totalProb)*Math.PI*2}));

      drawWheel();
    }

    function drawWheel(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      let start = currentAngle;
      segments.forEach(seg=>{
        ctx.beginPath();
        ctx.moveTo(center,center);
        ctx.arc(center,center,radius,start,start+seg.angle);
        ctx.closePath();
        ctx.fillStyle = seg.color;
        ctx.fill();
        ctx.strokeStyle = '#020617';
        ctx.lineWidth = 3;
        ctx.stroke();

        ctx.save();
        ctx.translate(center,center);
        ctx.rotate(start + seg.angle/2);
        ctx.fillStyle = 'white';
        ctx.font = 'bold 13px Inter';
        ctx.textAlign = 'right';
        ctx.fillText(seg.label, radius-12,4);
        ctx.restore();

        start += seg.angle;
      });
    }

    function easeOutCubic(t){return 1-Math.pow(1-t,3)}

    function spin(){
      if(spinning) return;
      spinning = true;
      document.getElementById('result').textContent = '';

      const spins = 6 + Math.random()*4;
      const finalAngle = spins*Math.PI*2 + Math.random()*Math.PI*2;
      const duration = 4500;
      const startTime = performance.now();

      function animate(now){
        const elapsed = now-startTime;
        const t = Math.min(elapsed/duration,1);
        const eased = easeOutCubic(t);
        currentAngle = finalAngle * eased;
        drawWheel();
        if(t<1){
          requestAnimationFrame(animate);
        }else{
          spinning = false;
          showResult(finalAngle);
        }
      }
      requestAnimationFrame(animate);
    }

    function angleToPrize(angle){
      const norm = (Math.PI*2 - (angle%(Math.PI*2)) + Math.PI*2)%(Math.PI*2);
      let acc = 0;
      for(const seg of segments){
        acc += seg.angle;
        if(norm <= acc) return seg;
      }
      return segments[0];
    }

    function showResult(angle){
      const prize = angleToPrize(angle);
      const resEl = document.getElementById('result');
      resEl.textContent = `üéâ Vous avez gagn√© : ${prize.label}`;
      confetti({particleCount:120,spread:80,origin:{y:0.7}});
      const lastEmail = localStorage.getItem('lastEmail')||'inconnu';
      const entry = `${new Date().toLocaleString('fr-FR')} ‚Ä¢ ${lastEmail} ‚Üí ${prize.label}`;
      let history = JSON.parse(localStorage.getItem('rouletteLogs')||'[]');
      history.unshift(entry);
      history = history.slice(0,20);
      localStorage.setItem('rouletteLogs',JSON.stringify(history));
    }

    document.getElementById('spinBtn').addEventListener('click',spin);
  </script>
</body>
</html>
