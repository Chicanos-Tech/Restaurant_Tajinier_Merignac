<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Roulette gourmande - Tajinier</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Inter',sans-serif;background:radial-gradient(circle at top,#111827,#020617);min-height:100vh;display:flex;align-items:center;justify-content:center;color:white;padding:20px}
    .wrapper{max-width:900px;width:100%;display:flex;flex-wrap:wrap;align-items:center;justify-content:center;gap:32px}
    .wheel-container{position:relative;width:360px;height:360px;border-radius:50%;background:radial-gradient(circle at 30% 30%,#facc15,#b45309);display:flex;align-items:center;justify-content:center;box-shadow:0 40px 80px rgba(0,0,0,.8)}
    #wheel{width:320px;height:320px;border-radius:50%;background:#020617;box-shadow:0 0 0 6px #facc15,0 0 30px rgba(250,204,21,.7)}
    .pointer{position:absolute;top:-18px;left:50%;transform:translateX(-50%);width:0;height:0;border-left:18px solid transparent;border-right:18px solid transparent;border-bottom:30px solid #facc15;filter:drop-shadow(0 4px 6px rgba(0,0,0,.8))}
    .side{max-width:380px}
    .title{font-size:2rem;font-weight:700;margin-bottom:6px}
    .subtitle{color:#e5e7eb;margin-bottom:14px}
    .chip{display:inline-block;background:linear-gradient(135deg,#f97316,#ea580c);padding:6px 12px;border-radius:999px;font-size:.8rem;margin-bottom:18px}
    .btn{margin-top:12px;width:100%;padding:14px;border-radius:999px;border:none;background:linear-gradient(135deg,#22c55e,#16a34a);color:white;font-size:1rem;font-weight:600;cursor:pointer;box-shadow:0 25px 40px -18px rgba(34,197,94,.9);transition:.2s}
    .btn:hover{transform:translateY(-2px);box-shadow:0 30px 60px -20px rgba(34,197,94,1)}
    .result{margin-top:18px;font-size:1.2rem;font-weight:600;min-height:28px}
    .small{margin-top:10px;font-size:.85rem;color:#9ca3af}
    @media(max-width:768px){.wrapper{flex-direction:column}}
  </style>
</head>
<body>
  <div class="wrapper">
    <div class="wheel-container">
      <canvas id="wheel" width="320" height="320"></canvas>
      <div class="pointer"></div>
    </div>
    <div class="side">
      <div class="title">Roulette gourmande</div>
      <div class="subtitle">Merci pour votre avis Google ! Tournez la roue et tentez de gagner un tajine, une boisson ou un dessert maison.</div>
      <div class="chip">Tajinier ‚Ä¢ Jeu instantan√©</div>
      <button id="spinBtn" class="btn">üé∞ Lancer la roulette</button>
      <div id="result" class="result"></div>
      <div class="small">Email : <span id="emailDisplay">inconnu</span><br>Pr√©senter ce r√©sultat √† l'√©quipe en salle pour recevoir votre gain.</div>
    </div>
  </div>

  <script>
    const prizes = [
      { label:'Canette gratuite', color:'#22c55e', prob:0.2 },
      { label:'Bi√®re pression', color:'#f97316', prob:0.15 },
      { label:'Tajine offert', color:'#ef4444', prob:0.15 },
      { label:'Desserts maison', color:'#ec4899', prob:0.15 },
      { label:'Th√© √† la menthe', color:'#22c55e', prob:0.1 },
      { label:'10% reduc prochain', color:'#3b82f6', prob:0.1 },
      { label:'Rien aujourd'hui', color:'#6b7280', prob:0.15 }
    ];

    const lastEmail = localStorage.getItem('lastEmail');
    if(lastEmail) document.getElementById('emailDisplay').textContent = lastEmail;

    const canvas = document.getElementById('wheel');
    const ctx = canvas.getContext('2d');
    const center = canvas.width / 2;
    const radius = center - 8;

    const totalProb = prizes.reduce((s,p)=>s+p.prob,0);
    const segments = prizes.map(p=>({...p,angle:(p.prob/totalProb)*Math.PI*2}));

    let currentAngle = 0;
    let spinning = false;

    function drawWheel(){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      let start = currentAngle;
      segments.forEach(seg=>{
        ctx.beginPath();
        ctx.moveTo(center,center);
        ctx.arc(center,center,radius,start,start+seg.angle);
        ctx.closePath();
        ctx.fillStyle = seg.color;
        ctx.fill();
        ctx.strokeStyle = '#020617';
        ctx.lineWidth = 3;
        ctx.stroke();

        ctx.save();
        ctx.translate(center,center);
        ctx.rotate(start + seg.angle/2);
        ctx.fillStyle = 'white';
        ctx.font = 'bold 13px Inter';
        ctx.textAlign = 'right';
        ctx.fillText(seg.label, radius-12,4);
        ctx.restore();

        start += seg.angle;
      });
    }

    function easeOutCubic(t){return 1-Math.pow(1-t,3)}

    function spin(){
      if(spinning) return;
      spinning = true;
      document.getElementById('result').textContent = '';

      const spins = 6 + Math.random()*4;
      const finalAngle = spins*Math.PI*2 + Math.random()*Math.PI*2;
      const duration = 4500;
      const startTime = performance.now();

      function animate(now){
        const elapsed = now-startTime;
        const t = Math.min(elapsed/duration,1);
        const eased = easeOutCubic(t);
        currentAngle = finalAngle * eased;
        drawWheel();
        if(t<1){
          requestAnimationFrame(animate);
        }else{
          spinning = false;
          showResult(finalAngle);
        }
      }
      requestAnimationFrame(animate);
    }

    function angleToPrize(angle){
      const norm = (Math.PI*2 - (angle%(Math.PI*2)) + Math.PI*2)%(Math.PI*2);
      let acc = 0;
      for(const seg of segments){
        acc += seg.angle;
        if(norm <= acc) return seg;
      }
      return segments[0];
    }

    function showResult(angle){
      const prize = angleToPrize(angle);
      const resEl = document.getElementById('result');
      resEl.textContent = `üéâ Vous avez gagn√© : ${prize.label}`;
      confetti({particleCount:120,spread:80,origin:{y:0.7}});
      const entry = `${new Date().toLocaleString('fr-FR')} ‚Ä¢ ${(lastEmail||'inconnu')} ‚Üí ${prize.label}`;
      let history = JSON.parse(localStorage.getItem('rouletteLogs')||'[]');
      history.unshift(entry);
      history = history.slice(0,20);
      localStorage.setItem('rouletteLogs',JSON.stringify(history));
    }

    document.getElementById('spinBtn').addEventListener('click',spin);
    drawWheel();
  </script>
</body>
</html>
