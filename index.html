<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avis & Gains - Tajinier M√©rignac</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js">
    <style>
        /* M√™me CSS que pr√©c√©demment - inchang√© pour perf */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Inter', sans-serif; 
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); 
            min-height: 100vh; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            padding: 20px; color: #1e293b; 
        }
        .container { max-width: 500px; width: 100%; text-align: center; }
        .logo { font-family: 'Poppins', sans-serif; font-size: 2.5rem; font-weight: 700; background: linear-gradient(135deg, #ef4444, #dc2626); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 10px; } /* Rouge marocain */
        .subtitle { font-size: 1.1rem; color: #64748b; margin-bottom: 40px; }
        .form-group { margin-bottom: 25px; }
        input[type="email"] { 
            width: 100%; padding: 16px 20px; font-size: 1rem; border: 2px solid #e2e8f0; border-radius: 12px; transition: all 0.3s ease; 
            font-family: inherit; background: white; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); 
        }
        input:focus { outline: none; border-color: #ef4444; box-shadow: 0 10px 15px -3px rgba(239,68,68,0.4); transform: translateY(-2px); }
        .btn { 
            background: linear-gradient(135deg, #ef4444, #dc2626); color: white; border: none; padding: 16px 40px; font-size: 1.1rem; font-weight: 600; 
            border-radius: 12px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 10px 15px -3px rgba(239,68,68,0.4); 
            font-family: inherit; width: 100%; margin-bottom: 10px; 
        }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 20px 25px -5px rgba(239,68,68,0.5); }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
        .roulette-section { display: none; }
        #roueCanvas { 
            width: 350px; height: 350px; border-radius: 50%; 
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); margin: 0 auto 30px; 
            background: conic-gradient(from 0deg, #ef4444, #f59e0b, #10b981, #3b82f6, #8b5cf6, #ec4899, #ef4444); 
            position: relative; 
        }
        #roueCanvas::before { 
            content: ''; position: absolute; top: -15px; left: 50%; transform: translateX(-50%); 
            width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent; border-top: 30px solid #1e293b; 
            z-index: 10; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); 
        }
        .tourner-btn { background: linear-gradient(135deg, #10b981, #059669); box-shadow: 0 10px 15px -3px rgba(16,185,129,0.4); }
        .tourner-btn:hover { box-shadow: 0 20px 25px -5px rgba(16,185,129,0.5); }
        #resultat { font-size: 1.5rem; font-weight: 700; color: #059669; min-height: 50px; margin-top: 20px; opacity: 0; transform: translateY(20px); transition: all 0.5s ease; }
        .show { opacity: 1 !important; transform: translateY(0) !important; }
        .log { font-size: 0.9rem; color: #64748b; margin-top: 40px; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); max-height: 200px; overflow-y: auto; text-align: left; }
        @media (max-width: 480px) { #roueCanvas { width: 300px; height: 300px; } .logo { font-size: 2rem; } }
        .confetti { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 100; }
        .adresse { font-size: 0.9rem; color: #64748b; margin-top: 10px; font-style: italic; }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">Tajinier ‚≠ê</div>
        <p class="subtitle">Scannez, laissez un avis et tentez votre chance au Maroc !</p>
        <p class="adresse">49 Bis Av. Henri Vigneau, 33700 M√©rignac</p>
        
        <form id="emailForm" class="form-group">
            <input type="email" id="email" placeholder="Votre email" required>
            <button type="submit" class="btn">üåü Laisser un avis Google</button>
        </form>
        
        <div id="rouletteSection" class="roulette-section">
            <canvas id="roueCanvas" width="350" height="350"></canvas>
            <p>Merci pour votre avis ! Tournez pour gagner un tajine ou plus...</p>
            <button id="tournerBtn" class="btn tourner-btn">üé∞ Tourner la roulette</button>
            <div id="resultat"></div>
        </div>
        
        <div id="logs" class="log" style="display: none;">Historique des gains :</div>
    </div>

    <script>
        // === CONFIG TAJINIER M√âRIGNAC ===
        const RESTO_CONFIG = {
            nom: 'Tajinier',
            placeId: 'ChIJrTLr-GyuEmsRBfy61i59si0', // Confirm√© pour Tajinier M√©rignac
            gains: [
                { nom: 'Canette gratuite', couleur: '#10b981', prob: 0.2 },
                { nom: 'Bi√®re pression', couleur: '#f59e0b', prob: 0.15 },
                { nom: 'Tajine offert', couleur: '#ef4444', prob: 0.15 }, // Th√©matique marocain
                { nom: 'Desserts maison', couleur: '#ec4899', prob: 0.15 },
                { '10% reduc prochain', couleur: '#3b82f6', prob: 0.1 },
                { nom: 'Th√© √† la menthe GRATUIT', couleur: '#10b981', prob: 0.1 },
                { nom: 'Rien aujourd\'hui', couleur: '#6b7280', prob: 0.15 }
            ]
        };
        const reviewUrl = `https://search.google.com/local/writereview?placeid=${RESTO_CONFIG.placeId}`;

        // Le reste du script JS identique au pr√©c√©dent (roulette, events...)
        const canvas = document.getElementById('roueCanvas');
        const ctx = canvas.getContext('2d');
        const centerX = canvas.width / 2;
        const centerY = canvas.height / 2;
        const radius = 160;
        let currentAngle = 0;
        let isSpinning = false;

        const emailForm = document.getElementById('emailForm');
        const rouletteSection = document.getElementById('rouletteSection');
        const tournerBtn = document.getElementById('tournerBtn');
        const resultat = document.getElementById('resultat');
        const logs = document.getElementById('logs');

        const totalProb = RESTO_CONFIG.gains.reduce((sum, g) => sum + g.prob, 0);
        const gainsNorm = RESTO_CONFIG.gains.map(g => ({...g, sliceAngle: (g.prob / totalProb) * 2 * Math.PI }));

        function drawWheel() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            let startAngle = currentAngle;
            gainsNorm.forEach((gain, i) => {
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, startAngle, startAngle + gain.sliceAngle);
                ctx.fillStyle = gain.couleur;
                ctx.fill();
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 3;
                ctx.stroke();

                ctx.save();
                ctx.translate(centerX, centerY);
                ctx.rotate(startAngle + gain.sliceAngle / 2);
                ctx.textAlign = 'right';
                ctx.fillStyle = 'white';
                ctx.font = 'bold 16px Inter';
                ctx.shadowColor = 'rgba(0,0,0,0.5)';
                ctx.shadowBlur = 4;
                ctx.fillText(gain.nom, radius - 20, 5);
                ctx.restore();

                startAngle += gain.sliceAngle;
            });
        }

        function spinWheel() {
            if (isSpinning) return;
            isSpinning = true;
            const spins = 5 + Math.random() * 5;
            const targetAngle = (Math.PI * 2 * spins) + (Math.random() * Math.PI * 2);
            const duration = 5000;
            const startTime = Date.now();

            function animate() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const easeOut = 1 - Math.pow(1 - progress, 3);

                currentAngle = targetAngle * easeOut;
                drawWheel();

                if (progress < 1) {
                    requestAnimationFrame(animate);
                } else {
                    isSpinning = false;
                    showResult(targetAngle);
                }
            }
            animate();
        }

        function getWinningGain(finalAngle) {
            const normalizedAngle = (finalAngle % (Math.PI * 2) + Math.PI * 2) % (Math.PI * 2);
            let cumulative = 0;
            for (let i = 0; i < gainsNorm.length; i++) {
                cumulative += gainsNorm[i].sliceAngle;
                if (normalizedAngle < cumulative) return gainsNorm[i];
            }
            return gainsNorm[0];
        }

        function showResult(finalAngle) {
            const gain = getWinningGain(finalAngle);
            resultat.textContent = `üéâ F√©licitations ! Vous avez gagn√© : ${gain.nom}`;
            resultat.classList.add('show');
            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 }
            });
            logGain(gain);
        }

        function logGain(gain) {
            const email = localStorage.getItem('lastEmail') || 'Anonyme';
            const entry = `${new Date().toLocaleString('fr-FR')}: ${email} ‚Üí ${gain.nom}`;
            let logsArray = JSON.parse(localStorage.getItem('rouletteLogs') || '[]');
            logsArray.unshift(entry);
            logsArray = logsArray.slice(0, 10);
            localStorage.setItem('rouletteLogs', JSON.stringify(logsArray));
            updateLogsDisplay();
        }

        function updateLogsDisplay() {
            const logsArray = JSON.parse(localStorage.getItem('rouletteLogs') || '[]');
            logs.innerHTML = logsArray.length ? 'Historique des gains :<br>' + logsArray.join('<br>') : 'Aucun gain encore.';
            logs.style.display = 'block';
        }

        emailForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            if (!email || !/\S+@\S+\.\S+/.test(email)) return alert('Email valide requis !');
            localStorage.setItem('lastEmail', email);
            window.open(reviewUrl, '_blank');
            emailForm.style.display = 'none';
            rouletteSection.style.display = 'block';
            drawWheel();
            updateLogsDisplay();
        });

        tournerBtn.addEventListener('click', spinWheel);

        drawWheel();
        updateLogsDisplay();
    </script>
</body>
</html>
